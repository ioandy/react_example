<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="Generator" content="EditPlusÂ®">
    <meta name="Author" content="">
    <meta name="Keywords" content="">
    <meta name="Description" content="">
    <title>Document</title>
</head>
<body>
    <h2>çŠ¶æ€æ”¹å˜ -> æ„å»ºæ–°çš„ DOM å…ƒç´ æ›´æ–°é¡µé¢</h2>
    <h5>ä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå°±é‡æ–°è°ƒç”¨ render æ–¹æ³•ï¼Œæ„å»ºä¸€ä¸ªæ–°çš„ DOM å…ƒç´ </h5>

    <div class='wrapper'> </div>

    <script type="text/javascript">
        const createDOMFromString = (domString) => {
            const div = document.createElement('div')
            div.innerHTML = domString
            return div
        }

        class LikeButton {
            constructor() {
                this.state = {isLiked: true}
            }

            setState(state) {
                // æ”¹å˜çŠ¶æ€çš„åŒæ—¶ï¼Œéœ€è¦æ›´æ–°Dom
                const oldEl = this.el
                this.state = state;
                this.el = this.render();
                if (this.onStateChange)
                    this.onStateChange(oldEl, this.el)
            }

            changeLikeText() {
                this.setState({
                    isLiked: !this.state.isLiked
                });
            }

            render() {
                this.el = createDOMFromString(
                    `
                        <button id='like-btn'>
                          <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}</span>
                          <span>ğŸ‘</span>
                        </button>
                    `
                );
                this.el.addEventListener('click', this.changeLikeText.bind(this), false);
                return this.el;
            }
        }

        const wrapper = document.querySelector('.wrapper')
        const button = new LikeButton();
        wrapper.appendChild(button.render()); // ç¬¬ä¸€æ¬¡æ’å…¥ DOM å…ƒç´ 
        button.onStateChange = (oldEl, newEl) => {
            wrapper.insertBefore(newEl, oldEl) // æ’å…¥æ–°çš„å…ƒç´ 
            wrapper.removeChild(oldEl) // åˆ é™¤æ—§çš„å…ƒç´ 
        }

        /*
        è¿™é‡Œæ¯æ¬¡ setState éƒ½ä¼šè°ƒç”¨ onStateChange æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯å®ä¾‹åŒ–ä»¥åæ—¶å€™è¢«è®¾ç½®çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥è‡ªå®šä¹‰ onStateChange çš„è¡Œä¸ºã€‚
        è¿™é‡Œåšçš„äº‹æ˜¯ï¼Œæ¯å½“ setState ä¸­æ„é€ å®Œæ–°çš„ DOM å…ƒç´ ä»¥åï¼Œå°±ä¼šé€šè¿‡ onStateChange å‘ŠçŸ¥å¤–éƒ¨æ’å…¥æ–°çš„ DOM å…ƒç´ ï¼Œç„¶ååˆ é™¤æ—§çš„å…ƒç´ ï¼Œé¡µé¢å°±æ›´æ–°äº†ã€‚
        è¿™é‡Œå·²ç»åšåˆ°äº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–äº†ï¼šç°åœ¨ä¸éœ€è¦å†æ‰‹åŠ¨æ›´æ–°é¡µé¢äº†ã€‚
        éä¸€èˆ¬çš„æš´åŠ›ï¼Œå› ä¸ºæ¯æ¬¡ setState éƒ½é‡æ–°æ„é€ ã€æ–°å¢ã€åˆ é™¤ DOM å…ƒç´ ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨è¿›è¡Œå¤§é‡çš„é‡æ’ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚
        ä¸è¿‡æ²¡æœ‰å…³ç³»ï¼Œè¿™ç§æš´åŠ›è¡Œä¸ºå¯ä»¥è¢«ä¸€ç§å« Virtual-DOM çš„ç­–ç•¥è§„é¿æ‰ã€‚
         */

    </script>
</body>
</html>